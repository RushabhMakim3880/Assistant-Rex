# 3.2 Code Architecture & Module Reference

---

## 1. Module Responsibilities

### Frontend (`src/*`)
*   **`App.jsx`**: Main layout container. Handles Socket.IO connection setup.
*   **`NeuralCore.jsx`**: Visualizer component. Reacts to `state` (idle/speaking) and `intensity` props.
*   **`ThoughtStream.jsx`**: Text display for User/AI conversation history.

### Backend (`backend/*`)
*   **`server.py`**:
    *   **`@sio.event start_audio`**: Triggered by frontend to begin listening.
    *   **`on_audio_data`**: Callback from `rex.py`. Emits intensity data to frontend.
*   **`rex.py`**:
    *   **`AudioLoop`**: Threaded class. Reads PyAudio stream.
    *   **`listen_audio()`**: Async loop. Checks RMS > Threshold -> triggers VAD.
    *   **`process_input()`**: Sends text to Gemini -> Receives Tool Call or Text.

## 2. Event Lifecycle
1.  **Init:** `App.jsx` mounts -> `sio.connect()`.
2.  **Start:** `App.jsx` emits `start_audio` -> Python `audio_loop.start()`.
3.  **Loop:**
    *   Python detects speech -> `sio.emit('transcription', text)`.
    *   Python gets response -> `sio.emit('audio_chunk', audio_blob)`.
    *   Python updates state -> `sio.emit('state_update', 'speaking')`.

## 3. Threading Model
*   **Main Process:** Electron (Node.js) - Single Threaded Event Loop.
*   **Backend:** Python - Asyncio Event Loop + ThreadPoolExecutor for blocking I/O (like heavy TTS generation or File operations).

## 4. Logging Responsibility
*   **Electron:** Captures `stdout`/`stderr` from Python and writes to `main_process_log.txt`.
*   **Python:** Uses `print()` for generic info (captured by Electron) and `traceback.print_exc()` for exceptions.
*   **React:** Logs UI rendering errors to the Browser Console (DevTools).
